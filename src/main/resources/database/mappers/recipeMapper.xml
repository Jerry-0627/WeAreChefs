<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    <mapper namespace="com.chef.app.recipe.RecipeDAO">
    

      <select id="getTotalCount" resultType="java.lang.Long">
   		SELECT COUNT(RECIPE_NUM) FROM RECIPE
  	 </select>
    
    <!-- 레시피 리스트 -->
    <select id="recipeList"  resultType="RecipeDTO">
    
    	SELECT *
    	FROM RECIPE
    	ORDER BY RECIPE_NUM DESC
    	<!-- <select id="recipeList" resultMap="recipeImgName" parameterType="com.chef.app.util.Pager"> -->
    	
    	
    		<!-- SELECT * 
    		FROM 
    			(SELECT ROWNUM R,B.* 
    			 FROM
    			 (
	    			SELECT *
					FROM RECIPE RC
						INNER JOIN
		     			RECIPEIMG RI
    			 			ON RC.RECIPE_NUM = RI.RECIPE_NUM
    			 	WHERE RECIPE_NAME LIKE '%'||#{search}||'%'
    			 	ORDER BY CREATE_DATE DESC
	    			)
	    			B
	    			)
	    	WHERE R BETWEEN #{startRow} AND #{lastRow} -->
     	</select>
    	
    	<!-- <resultMap type="RecipeDTO" id="recipeImgName">
		   	<id column="RECIPE_NUM" property="recipe_num"/>
		   	<result column="RECIPE_WRITER" property="recipe_writer"/>
		   	<result column="RECIPE_NAME" property="recipe_name"/>
		   	<result column="MENU_RECIPE" property="menu_recipe"/>
		   	<result column="CREATE_DATE" property="create_date"/>
		   	<result column="UPDATE_DATE" property="update_date"/>
		   	<result column="RECIPE_CATEGORY" property="recipe_category"/>
		   	<result column="RECIPE_LEVEL" property="recipe_level"/>
		   	<result column="RECIPE_TIME" property="recipe_time"/>
		   	<result column="RATING" property="rating"/>
		   	<result column="RECIPE_LIKE" property="recipe_like"/>
		   	<result column="RECIPE_HIT" property="recipe_hit"/>
		    <association property="recipeImgFileDTO" javaType="RecipeImgFileDTO">
    	<id column="RECIPE_IMG_NUM" property="file_num"/>
    	<result column="RECIPE_FILE_NAME" property="file_name"/> -->
   <!--  </association> -->
<!--    </resultMap> -->

 <!--    <select id="getLastInsertId" resultType="Long">
        SELECT RECIPE_SEQ.CURRVAL FROM DUAL
    </select>
    
 -->

    <!-- 레시피 등록 -->
    	<insert id="recipeAdd" parameterType="RecipeDTO">
    	<selectKey keyProperty="recipe_num" resultType="Long" order="AFTER" >
  			SELECT RECIPE_SEQ.CURRVAL FROM DUAL
  		</selectKey>
    	INSERT INTO RECIPE(
    						RECIPE_NUM 
    						,RECIPE_WRITER 
    						,RECIPE_NAME 
    						,MENU_RECIPE
    						,RECIPE_CATEGORY
    						,RECIPE_LEVEL
    						,RECIPE_TIME
    						)
					VALUES(
					RECIPE_SEQ.NEXTVAL
					,'ydb'
					,#{recipe_name}
					,#{menu_recipe}
					,#{recipe_category}
					,#{recipe_level}
					,#{recipe_time}
					)
			
	  </insert>
	      	<insert id="mainImg" parameterType="RecipeImgFileDTO">
		INSERT INTO RECIPEIMG(RECIPE_IMG_NUM, RECIPE_NUM, RECIPE_FILE_NAME) 
		VALUES (RECIPEIMG_SEQ.NEXTVAL,#{recipe_num},#{file_name})
	</insert>
    
    </mapper>
